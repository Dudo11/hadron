```{r setup}
devtools::load_all()
library(ggplot2)
```

```{r}
  

boot.R <- 100#100        # Hier muss angepasst werden!
boot.l <- 400#400        # block length
seed <- 1234

#==============================#
# Read in correlator files:    #
#==============================#

read <- function(n_phi) {
  corr <- readtextcf(paste0('/home/schlage/Master/R/correlators_',n_phi,'_phi_phi4p.tsv'), T = 24, skip = 4) # Hier muss angepasst werden!
  return(corr)
}

corr1 <- read(1)
corr2 <- read(2)
corr3 <- read(3)
corr4 <- read(4)
corr5 <- read(5)

#==============================#
# 1 particle corr:             #
#==============================#
uw1 <- uwerr.cf(corr1)
save(uw1, file = 'uw1.Rdata')
uw2 <- uwerr.cf(corr2)
save(uw2, file = 'uw2.Rdata')
uw3 <- uwerr.cf(corr3)
save(uw3, file = 'uw3.Rdata')
```

```{r}
samplecf_boot1 <- bootstrap.cf(corr1, boot.R = boot.R, boot.l = boot.l, seed = seed)
shifted_corr1 <- takeTimeDiff.cf(samplecf_boot1) # Calculate the shifted correlator

samplecf_boot2 <- bootstrap.cf(corr2, boot.R = boot.R, boot.l = boot.l, seed = seed)
shifted_corr2 <- takeTimeDiff.cf(samplecf_boot2) # Calculate the shifted correlator

samplecf_boot3 <- bootstrap.cf(corr3, boot.R = boot.R, boot.l = boot.l, seed = seed)
shifted_corr3 <- takeTimeDiff.cf(samplecf_boot3) # Calculate the shifted correlator

samplecf_boot4 <- bootstrap.cf(corr4, boot.R = boot.R, boot.l = boot.l, seed = seed)
shifted_corr4 <- takeTimeDiff.cf(samplecf_boot4) # Calculate the shifted correlator

samplecf_boot5 <- bootstrap.cf(corr5, boot.R = boot.R, boot.l = boot.l, seed = seed)
shifted_corr5 <- takeTimeDiff.cf(samplecf_boot5) # Calculate the shifted correlator
```

```{r}
# d1 <- new_matrixfit(shifted_corr1, 1, 11, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = FALSE)
# print(d1)
# pdf('corr1_T24L6.pdf')
# plot(d1, xlab="t", ylab="C_1 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

# d2 <- new_matrixfit(shifted_corr2, 1, 11, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = FALSE)
# print(d2)
# pdf('corr2_T24L6.pdf')
# plot(d2, xlab="t", ylab="C_2 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

#priors3 <- list(param = 3, p = (d2$t0[1] - d1$t0[1]), psamples = (d2$t[,1] - d1$t[,1]))
# d3 <- new_matrixfit(shifted_corr3, 1, 11, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = TRUE, priors = priors3, m = d1$t[,1], np=3)
# print(d3)
# pdf('corr3_T24L6.pdf')
# plot(d3, xlab="t", ylab="C_3 (t)", col="red", log = "y")
# dev.off()

calculate.energy.shift(psamples = c2$t[,1], msamples = c1$t[,1], n=2)

# c1 <- new_matrixfit(shifted_corr1, 1, 23, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = TRUE)
# print(c1)
# pdf('corr1_T48L14.pdf')
# plot(c1, xlab="t", ylab="C_1 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

# c2 <- new_matrixfit(shifted_corr2, 1, 23, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = TRUE, m = c1$t[,1], np=2)
# print(c2)
# pdf('corr2_T48L14.pdf')
# plot(c2, xlab="t", ylab="C_2 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

# priors3 <- list(param = 3, p = (c2$t0[1] - c1$t0[1]), psamples = (c2$t[,1] - c1$t[,1]))
# c3 <- new_matrixfit(shifted_corr3, 1, 23, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = TRUE, priors = priors3, m = c1$t[,1], np=3)
# print(c3)
# pdf('corr3_T48L14.pdf')
# plot(c3, xlab="t", ylab="C_3 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

# priors4 <- list(param = 3, p = (c3$t0[1] - c1$t0[1]), psamples = (c3$t[,1] - c1$t[,1]))
# c4 <- new_matrixfit(shifted_corr4, 1, 23, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = TRUE, priors = priors4, m = c1$t[,1], np=4)
# print(c4)
# pdf('corr4_T48L14.pdf')
# plot(c4, xlab="t", ylab="C_4 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

# priors5 <- list(param = c(3,5), p = c((c4$t0[1] - c1$t0[1]),(c3$t0[1] - c2$t0[1])), psamples = cbind((c4$t[,1] - c1$t[,1]),(c3$t[,1] - c2$t[,1])))
# c5 <- new_matrixfit(shifted_corr5, 1, 23, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', useCov = TRUE, priors = priors5, m = c1$t[,1], np=5)
# print(c5)
# pdf('corr5_T48L14.pdf')
# plot(c5, xlab="t", ylab="C_5 (t)", col="red", col.line = "black", log = "y", lwd = 1.4, cex = 1.4, cex.lab = 1.4, cex.axis = 1.3)
# dev.off()

# c5test <- new_matrixfit(shifted_corr5, 1, 23, fit.method = 'lm', model = 'single', sym.vec = 'sinh')
# print(c5test)

#z2 <- new_matrixfit(shifted_corr2, 1, 5, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh')
#p2 <- z2$t
#print(z2$t0[1])
#print(z2$t)

##priors3 <- list(param = 3, p = (z2$t0[1] - z1$t0[1]), psamples = (z2$t[,1] - z1$t[,1]))
# print(priors$param)
#print(priors$p)
# print(priors$psamples)
# print(cbind(priors$psamples, c(1:100))))
##z3 <- new_matrixfit(shifted_corr3, 1, 11, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', priors = priors3, m = z1$t[,1], np=3)

##print(z3)
##plot(z3)
#print(z3$t)
#print(z3$t[1,1])
# cat('\n')
# print(z1$par)
# print(z1$t0[1])
# print(z1$t0[2])

# samplecf_boot2 <- bootstrap.cf(corr2, boot.R = boot.R, boot.l = boot.l, seed = seed)
# shifted_corr2 <- takeTimeDiff.cf(samplecf_boot2) # Calculate the shifted correlator
# 
# z2 <- new_matrixfit(shifted_corr1, 1, 9, fit.method = 'lm', model = 'shifted', sym.vec = 'sinh')
# print(z2)
# cat('\n')
# print(z2$par)
# print(z2$t0)
# 
# parin <- c(z1$t0[1], z2$t0[2])
# print(parin)

#samplecf_boot3 <- bootstrap.cf(corr3, boot.R = boot.R, boot.l = boot.l, seed = seed)
#shifted_corr3 <- takeTimeDiff.cf(samplecf_boot3) # Calculate the shifted correlator

#z3 <- new_matrixfit(shifted_corr3, 1, 5, fit.method = 'lm', model = 'n_particles', sym.vec = 'sinh', param_vec = parin)
#print(z3)
#cat('\n')
#print(z3$par)
#print(z3$t0)
#data = data.frame(x.plot=z3$x,y.plot=z3$y)
#plot(shifted_corr3)
#plot(z3,xlim=range(0,12))
#plot(z3$x,z3$y[1:12])
#plot(z3)

#ggplot(uw3, aes(x = t, y = value)) +
#    geom_point() +
#    geom_errorbar(aes(ymin = value - dvalue, ymax = value + dvalue)) +
#    scale_y_log10()

```

